#! /bin/bash

# include the config
OSTMU_FOLDER="/opt/ostmu"
source "${OSTMU_FOLDER}/etc/config"

# define some vars
declare -a sim_names=()
user_config_folder_path="/home/${USER}/${USER_CONFIG_FOLDER_NAME}"

# check if tmux user folder exists and if not, create it
tmux_user_folder="${TMUX_SOCKET_FOLDER}/${USER}"
if [ ! -d "${tmux_user_folder}" ];then
  mkdir -p "${tmux_user_folder}"
  if [ ! $? -eq 0 ]; then
    exit 1;
  else
    echo -e ${SymbolPlus} $"The tmux user folder was created."
  fi
else
  echo -e ${SymbolOk} $"The tmux user folder exists."
fi

# check if the config folder exists
if [ ! -d "$user_config_folder_path" ]; then
  echo -e ${SymbolNotOk} $"The folder ${user_config_folder_path} does not exist."
  exit 1;
fi

# get the .sim folders in config
cd "${user_config_folder_path}"
for i in *.sim;do
  if [ -d $i ]; then
    fullname=$(basename "$i")
    #~ extension="${fullname##*.}"
    shortname="${fullname%.*}"
    echo -e ${SymbolOk} $"The folder ${fullname} exists."
    sim_names=("${sim_names[@]}" "${shortname}")
  fi
done

# check if there are ini files
sim_folders_qty=${#sim_names[@]}
if [ ${sim_folders_qty} -eq 0 ]; then
  echo -e ${SymbolNotOk} $"There are no .sim folders inside ${user_config_folder_path}."
  exit 1;
fi

if [ ${TMUX_MULTIPLE_SESSIONS} -eq 1 ]; then
  source "${OSTMU_FOLDER}/includes/tmux-multiple"
else
  source "${OSTMU_FOLDER}/includes/tmux-single"
fi
